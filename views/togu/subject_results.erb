<%
  data      = $togu.get(params[:id])
  all_moves = data[:moves]
  move_keys = [:type, :key, :val, :order, :g, :r, :t, :is_explore, :key_type, :key_val, :feedback, :final_pay]
%>

<h1> User Results: Subject <%=params[:id]%> </h1>
<div> <%=data[:user_data][:sex] %>, <%=data[:user_data][:age] %></div>
<hr/>
<button onclick=tableToExcel('table','data','data.xls') class='btn btn-primary btn-raised'>Download as excel</button>
<table id='table' class='table'>
  <thead>
    <% (['Subj_Number','Sex','Age','Game','Round'] + move_keys).each do |k| %>
      <th><%= k %></th>  
    <% end %>
  </thead>
  <tbody>
      <% all_moves.each do |game, rounds| %>
        <% rounds.each do |round, round_moves| %>          
          <% round_moves.each do |move| %>
          <tr>
            <td> <%=data[:user_data][:subject_number] %> </td>
            <td> <%=data[:user_data][:sex] %> </td>
            <td> <%=data[:user_data][:age] %> </td>
            <td> <%= game %> </td>
            <td> <%= round %> </td>
            <% move_keys.each do |key| %>
            <td> <%= move[key] %></td>
            <% end %>
          </tr>
          <% end %>
        <% end %>
      <% end %>
  </tbody>
</table>


<% if false %>
in each every line I also need:
- sex
- age
- Order,
- g   (game number)
- r  (round number)
- t, (trial number)
- type (GiveUp (1=a GiveUp matrix key, 0= a Try matrix key),
- Explore? (1=selecting a key for the first time in this round; 0=otherwise), 

- KeyType (1= H or MH key, 0=L or ML key), 
- KeyType (1= H or MH key, 0=L or ML key), 
- ExploreL (1= if GiveUp=0 and Explore=1 and KeyType=0), 
- ExploitL (1= if GiveUp=0 and Explore=0 and KeyType=0, zero otherwise), 
- KeyNumber^2 ???
- KeyValue (H/L/MH/ML), 
- Cost (1= if C was implemented because Explore=1, 0=if C was not implemented because Explore=0), 
- PayNoFeedback (KeyValue-Cost), 
- Feedback (+F/0/-F),
- FinalPay (KeyValue-Cost+Feedback).
<% end %>